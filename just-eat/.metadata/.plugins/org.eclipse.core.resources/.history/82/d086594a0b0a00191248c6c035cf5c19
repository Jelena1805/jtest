package testsParcelPickup;

import java.io.IOException;
import java.sql.Array;
import java.sql.Connection;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.sql.Statement;
import org.junit.Assert;
import org.junit.BeforeClass;
import org.junit.Test;

import com.eclipsesource.json.Json;
import com.eclipsesource.json.JsonArray;
import com.eclipsesource.json.JsonObject;
import com.eclipsesource.json.JsonValue;

import main.java.Helper;
import okhttp3.MediaType;
import okhttp3.OkHttpClient;
import okhttp3.Request;
import okhttp3.RequestBody;
import okhttp3.Response;

import java.util.Objects;
import java.util.concurrent.ThreadLocalRandom;


public class PickupOndemandGetPrice {
	private static Helper helper;


	
	@BeforeClass
	public static void setUp() throws Exception {
		helper = Helper.getInstance();
		System.out.println("Starting test " + new Object() {}.getClass().getEnclosingMethod().getName());
	}
	
	@Test
	public void flagsFalse() throws IOException, SQLException  {	
		String customer = "0007023210";
		String date = "2018-12-20";
		String contractId="";
		String postalCode="l4x2r1";
		String pwwFlag="false";
		String priorityFlag="false";
				
        String url =helper.getProperty("ppstaging")+"/purs/pickup/price/"+customer+"?contractId="+contractId+"&date="+date+"&pwwFlag="+pwwFlag+"&priorityFlag="+priorityFlag+"&postalCode="+postalCode;  
        OkHttpClient client = new OkHttpClient();

        Request request = new Request.Builder()
          .url(url)
          .get()
          .addHeader("Accept", "application/vnd.cpc.purs-v1+json")
          .addHeader("Cache-Control", "no-cache")
          .addHeader("Postman-Token", "8aae1803-cf03-4450-a060-ce3b4cea6456")
          .build();

        Response response = client.newCall(request).execute();
        int responseCode =  response.code();
    	String responseBody =  response.body().string(); 
    	System.out.println(responseBody);
	    Assert.assertEquals("Response body", "{\"preTaxAmount\":3.5,\"gstAmount\":0.18,\"pstAmount\":0.0,\"hstAmount\":0.35,\"dueAmount\":4.03}", responseBody);	 	       		
	}
	
	@Test
	public void oneOfFlagsTrue() throws IOException, SQLException  {	
		String customer = "0007023210";
		String date = "2018-12-20";
		String contractId="";
		String postalCode="l4x2r1";
		String pwwFlag="true";
		String priorityFlag="false";
				
        String url =helper.getProperty("ppstaging")+"/purs/pickup/price/"+customer+"?contractId="+contractId+"&date="+date+"&pwwFlag="+pwwFlag+"&priorityFlag="+priorityFlag+"&postalCode="+postalCode;  
        OkHttpClient client = new OkHttpClient();

        Request request = new Request.Builder()
          .url(url)
          .get()
          .addHeader("Accept", "application/vnd.cpc.purs-v1+json")
          .addHeader("Cache-Control", "no-cache")
          .addHeader("Postman-Token", "8aae1803-cf03-4450-a060-ce3b4cea6456")
          .build();

        Response response = client.newCall(request).execute();
        int responseCode =  response.code();
    	Assert.assertEquals("Response Code",200, responseCode);   
    	String responseBody =  response.body().string(); 
    	System.out.println(responseBody);
	    Assert.assertEquals("Response body", "{\"preTaxAmount\":0,\"gstAmount\":0,\"pstAmount\":0,\"hstAmount\":0,\"dueAmount\":0}", responseBody);	 	       		
	}
	
}
