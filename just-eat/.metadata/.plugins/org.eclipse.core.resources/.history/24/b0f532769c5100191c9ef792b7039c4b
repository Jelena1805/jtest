package testsParcelPickup;

import java.io.IOException;
import java.sql.SQLException;
import java.text.ParseException;
import java.time.LocalDate;

import org.json.JSONException;
import org.junit.Assert;
import org.junit.Test;
import main.java.Helper;
import okhttp3.MediaType;
import okhttp3.OkHttpClient;
import okhttp3.Request;
import okhttp3.RequestBody;
import okhttp3.Response;







public class ValidateOnDemand {

	private static Helper helper;
	LocalDate randomDate;


	@Test
	public void validateOnDemand() throws InterruptedException, IOException, JSONException, ParseException, SQLException {
		helper = Helper.getInstance();
		String url ="http://ows-arz-sha-stg-02.cpggpc.ca:5043/purs/0007023221/pickuprequest/validation";
		randomDate = helper.getRandomDate();

        OkHttpClient client = new OkHttpClient();
        String json = "{\n" + 
        		"\"contactInfo\":\n" + 
        		"{ \"contactNm\": \"Jelena Stanojevic\", \"email\": \"bubazelena@email.com\", \"lang\": \"f\", \"optOutEmailUpdatesFlag\": false, \"phone\": \"613-123-4567\", \"phoneExt\": \"786\", \"receiveEmailUpdate\": false }\n" + 
        		",\n" + 
        		"\"customerRequestId\": \"987654321\",\n" + 
        		"\"itemsCharacteristic\":\n" + 
        		"{ \"unitWeightType\": \"lbs\", \"estimatedDepth\": 25, \"estimatedDimension\": \"Estimated dimension\", \"estimatedHeight\": 25, \"estimatedWeight\": 3.2, \"estimatedWidth\": 25, \"heavyItems\": true, \"iilpFlag\": false, \"otherFlag\": false, \"priorityItems\": true, \"returnItems\": true, \"worldwideItems\": true }\n" + 
        		",\n" + 
        		"\"locationDetail\":\n" + 
        		"{ \"5TonTruckRequired\": true, \"loadingDockExist\": true, \"pickupInstruction\": \"Call me when you are here\" }\n" + 
        		",\n" + 
        		"\"payerCustomerNum\": \"string\",\n" + 
        		"\"payment\": {\n" + 
        		"\"contractId\": \"\",\n" + 
        		"\"creditCardInfo\":\n" + 
        		"{ \"authAmt\": 3.96, \"authDate\": \"2019-02-15\", \"authNbr\": \"827685\", \"authRefNbr\": \"171604-0_13\", \"authResult\": \"A\", \"authResultDesc\": \"APPROVED\", \"authTime\": \"11:16\", \"authed\": true, \"billAmt\": 0, \"cardExpiryDate\": \"12-2026\", \"cardNbr\": \"520473HBzlGf3884\", \"cardType\": \"MC\", \"currency\": \"CAD\", \"currencyIso\": \"CAD\", \"externalSysCall\": \"C\", \"holderNm\": \"TEST BUSINESS\", \"paymentId\": \"2d373234343739383332313938333339\", \"transactionId\": \"171604-0_13\" }\n" + 
        		",\n" + 
        		"\"paymentMethod\": \"CreditCard\",\n" + 
        		"\"promoCd\": \"ABCD\"\n" + 
        		"},\n" + 
        		"\"pickupLocation\": {\n" + 
        		"\"alternateAddr\":\n" + 
        		"{ \"addrLn1\": \"365 March Road\", \"city\": \"Ottawa\", \"companyNm\": \"Innovapost Inc.\", \"countryCd\": \"CA\", \"postalCode\": \"K2K3N5\", \"province\": \"ON\" }\n" + 
        		",\n" + 
        		"\"businessAddr\": true\n" + 
        		"},\n" + 
        		"\"pickupTime\":\n" + 
        		"{ \"closingTime\": \"18:00\", \"date\": \""+randomDate+"\", \"preferredTime\": \"13:00\" }\n" + 
        		//"{ \"closingTime\": \"23:00\", \"date\": \"2019-05-14\", \"preferredTime\": \"22:00\" }\n" +
        		",\n" + 
        		"\"pickupVolume\": \"5 pallets\"\n" + 
        		"}";

        RequestBody body = RequestBody.create(
      	      MediaType.parse("application/json; charset=utf-8"), json);
      Request request = new Request.Builder()
        .url(url)
        .put(body)
        .addHeader("Content-Type", "application/vnd.cpc.purs-v1+json")
        .addHeader("Accept", "application/vnd.cpc.purs-v1+json")
        .addHeader("Cache-Control", "no-cache")
        .build();
      Response response = client.newCall(request).execute();
  	int responseCode =  response.code();
  	String responseBody =  response.body().string(); 
  	System.out.println(responseBody);
  	Assert.assertEquals("Response Code",200, responseCode);  
  	
  	
	    Assert.assertEquals("Response body", "{ \"valid\":true }", responseBody);
	    	
	    
		
		
	}	
}
